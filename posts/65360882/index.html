<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="K8S二次开发系列之四：自定义开发Controller, 洪宇轩的博客">
    <meta name="description" content="本文介绍了Kubernetes Controller的工作原理、Kubernetes API List/Watch的机制，以及client-go提供的Informer库，教你通过以上技术自定义开发自己的Controller。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>K8S二次开发系列之四：自定义开发Controller | 洪宇轩的博客</title>
    <link rel="icon" type="image/png" href="/blog/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/blog/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/blog/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/blog/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/blog/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/blog/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/blog/css/matery.css">
<link rel="stylesheet" type="text/css" href="/blog/css/my.css">
<link rel="stylesheet" type="text/css" href="/blog/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/blog/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/blog/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/blog/css/reward.css">
    



    <script src="/blog/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/blog/" class="waves-effect waves-light">
                    
                    <img src="/blog/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">洪宇轩的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/blog/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/blog/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/blog/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/blog/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/blog/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/blog/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/blog/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>我的收藏</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/blog/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">洪宇轩的博客</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/blog/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/blog/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/blog/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/blog/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/blog/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/blog/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/blog/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			我的收藏
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://blog-1255547500.cos.ap-beijing.myqcloud.com/images%2Fcncf%2Fk8s%2Fcustom%2Fcontroller_banner.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">K8S二次开发系列之四：自定义开发Controller</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/blog/tags/cloud-native/">
                                <span class="chip bg-color">cloud native</span>
                            </a>
                        
                            <a href="/blog/tags/kubernetes/">
                                <span class="chip bg-color">kubernetes</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/blog/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/" class="post-category">
                                云原生
                            </a>
                        
                            <a href="/blog/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/" class="post-category">
                                kubernetes
                            </a>
                        
                            <a href="/blog/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/K8S%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97/" class="post-category">
                                K8S二次开发系列
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-12-15
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    7.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    39 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/blog/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>Kubernetes中，Controller是一个非常重要的组件，它可以根据我们声明的资源期望状态和实际状态来进行调谐（Reconcile），以确保我们的应用程序始终处于所需的状态。本文将介绍Controller的工作原理，并介绍如何编写一个Controoler</p>
<h2 id="Controller工作原理">Controller工作原理</h2>
<p>在K8s中，用户通过声明式API定义资源的“预期状态”，Controller则负责监视资源的实际状态，当资源的实际状态和“预期状态”不一致时，Controller则对系统进行必要的更改，以确保两者一致，这个过程被称之为调谐（Reconcile）。</p>
<p>K8s中有多种类型的Controller，例如Deployment Controller、ReplicaSet Controller和StatefulSet Controller等。每个控制器都有不同的工作原理和适用场景，但它们的基本原理都是相同的。我们也可以根据需要编写Controller来实现自定义的业务逻辑。</p>
<h2 id="K8S-HTTP-API的List-Watch机制">K8S HTTP API的List/Watch机制</h2>
<p>Controller需要监视K8S中资源的状态，这是如何实现的呢？</p>
<p>K8S Apiserver提供了常规的资源List接口，如下所示：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token string">'https://192.168.126.100:6443/api/v1/namespaces/default/pods'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--header</span> <span class="token string">'Authorization: Bearer Token'</span>
<span class="token punctuation">&#123;</span>
    <span class="token string">"kind"</span><span class="token builtin class-name">:</span> <span class="token string">"PodList"</span>,
    <span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span> <span class="token string">"v1"</span>,
    <span class="token string">"metadata"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">"resourceVersion"</span><span class="token builtin class-name">:</span> <span class="token string">"18128858"</span>
    <span class="token punctuation">&#125;</span>,
    <span class="token string">"items"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            <span class="token string">"metadata"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>
                <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"nginx-68544fd76d-jjlsj"</span>,
                <span class="token string">"generateName"</span><span class="token builtin class-name">:</span> <span class="token string">"nginx-68544fd76d-"</span>,
                <span class="token string">"namespace"</span><span class="token builtin class-name">:</span> <span class="token string">"default"</span>,
                <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"6d209662-dc6b-48b6-8768-57e34a8ebe62"</span>,
                <span class="token string">"resourceVersion"</span><span class="token builtin class-name">:</span> <span class="token string">"17940143"</span>,
                <span class="token string">"creationTimestamp"</span><span class="token builtin class-name">:</span> <span class="token string">"2023-12-14T07:54:50Z"</span>,
                <span class="token string">"labels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token string">"app"</span><span class="token builtin class-name">:</span> <span class="token string">"nginx"</span>,
                    <span class="token string">"app_type"</span><span class="token builtin class-name">:</span> <span class="token string">"frontend"</span>,
                    <span class="token string">"pod-template-hash"</span><span class="token builtin class-name">:</span> <span class="token string">"68544fd76d"</span>
                <span class="token punctuation">&#125;</span>,
                <span class="token string">"annotations"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token string">"cni.projectcalico.org/containerID"</span><span class="token builtin class-name">:</span> <span class="token string">"160ffb3e8948966b33945a10e50299edc933937fcacf111d14fbcdddd131d09b"</span>,
                    <span class="token string">"cni.projectcalico.org/podIP"</span><span class="token builtin class-name">:</span> <span class="token string">"10.244.123.131/32"</span>,
                    <span class="token string">"cni.projectcalico.org/podIPs"</span><span class="token builtin class-name">:</span> <span class="token string">"10.244.123.131/32"</span>
                <span class="token punctuation">&#125;</span>,
                <span class="token string">"ownerReferences"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">&#123;</span>
                        <span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span> <span class="token string">"apps/v1"</span>,
                        <span class="token string">"kind"</span><span class="token builtin class-name">:</span> <span class="token string">"ReplicaSet"</span>,
                        <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"nginx-68544fd76d"</span>,
                        <span class="token string">"uid"</span><span class="token builtin class-name">:</span> <span class="token string">"ac770bcb-6369-44ed-8111-a746e1ce3955"</span>,
                        <span class="token string">"controller"</span><span class="token builtin class-name">:</span> true,
                        <span class="token string">"blockOwnerDeletion"</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">]</span>,
                <span class="token string">"managedFields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>……<span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>,
            <span class="token string">"spec"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>……<span class="token punctuation">&#125;</span>,
            <span class="token string">"status"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>……<span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面的API获取了default命名空间下面的所有pods列表。在返回值的<code>metadata</code>字段里有一个参数<code>resourceVersion</code>，该字段的值是此次List操作得到的资源的版本号。我们在watch请求中可以带上该版本号作为参数，Apiserver会watch将该版本之后的资源变化并通知客户端。</p>
<p>现在在URL后面加上参数<code>?watch=true</code>，则Apiserver会对default命名空间下面的pod的状态进行持续监控，并在pod状态发生变化时通过chunked Response(HTTP 1.1)或者Server Push(HTTP2)通知到客户端。K8S称此机制为watch。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token string">'https://192.168.126.100:6443/api/v1/namespaces/default/pods?watch=true&amp;resourceVersion=18128858'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--header</span> <span class="token string">'Authorization: Bearer Token'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>在另一个终端中创建一个名为nginx的pod，然后将其删除，可以看到下面的输出：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"ADDED"</span>,<span class="token string">"object"</span>:<span class="token punctuation">&#123;</span><span class="token string">"kind"</span><span class="token builtin class-name">:</span><span class="token string">"Pod"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d-6fggw"</span>,<span class="token string">"generateName"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d-"</span>,<span class="token string">"namespace"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"uid"</span><span class="token builtin class-name">:</span><span class="token string">"4f6c6528-1fdd-4f9d-a66d-74a5ac7d4142"</span>,<span class="token string">"resourceVersion"</span><span class="token builtin class-name">:</span><span class="token string">"18130095"</span>,<span class="token string">"creationTimestamp"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"labels"</span>:<span class="token punctuation">&#123;</span><span class="token string">"app"</span><span class="token builtin class-name">:</span><span class="token string">"nginx"</span>,<span class="token string">"app_type"</span><span class="token builtin class-name">:</span><span class="token string">"frontend"</span>,<span class="token string">"pod-template-hash"</span><span class="token builtin class-name">:</span><span class="token string">"68544fd76d"</span><span class="token punctuation">&#125;</span>,<span class="token string">"ownerReferences"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"apps/v1"</span>,<span class="token string">"kind"</span><span class="token builtin class-name">:</span><span class="token string">"ReplicaSet"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d"</span>,<span class="token string">"uid"</span><span class="token builtin class-name">:</span><span class="token string">"8f979c58-c687-43d1-badb-83a258a467ea"</span>,<span class="token string">"controller"</span>:true,<span class="token string">"blockOwnerDeletion"</span>:true<span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"managedFields"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"manager"</span><span class="token builtin class-name">:</span><span class="token string">"kube-controller-manager"</span>,<span class="token string">"operation"</span><span class="token builtin class-name">:</span><span class="token string">"Update"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"time"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"fieldsType"</span><span class="token builtin class-name">:</span><span class="token string">"FieldsV1"</span>,<span class="token string">"fieldsV1"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:generateName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:labels"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:app"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:app_type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:pod-template-hash"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:ownerReferences"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>uid<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>8f979c58-c687-43d1-badb-83a258a467ea<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:spec"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:containers"</span>:<span class="token punctuation">&#123;</span><span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>name<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>nginx-container<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:image"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:imagePullPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:name"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:resources"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:limits"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cpu"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:memory"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:requests"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cpu"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:memory"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationMessagePath"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationMessagePolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:dnsPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:enableServiceLinks"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:restartPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:schedulerName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:securityContext"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:serviceAccount"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:serviceAccountName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationGracePeriodSeconds"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>,<span class="token string">"spec"</span>:<span class="token punctuation">&#123;</span><span class="token string">"volumes"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-api-access-7897x"</span>,<span class="token string">"projected"</span>:<span class="token punctuation">&#123;</span><span class="token string">"sources"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"serviceAccountToken"</span>:<span class="token punctuation">&#123;</span><span class="token string">"expirationSeconds"</span>:3607,<span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"token"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"configMap"</span>:<span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-root-ca.crt"</span>,<span class="token string">"items"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"ca.crt"</span>,<span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"ca.crt"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"downwardAPI"</span>:<span class="token punctuation">&#123;</span><span class="token string">"items"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"namespace"</span>,<span class="token string">"fieldRef"</span>:<span class="token punctuation">&#123;</span><span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"fieldPath"</span><span class="token builtin class-name">:</span><span class="token string">"metadata.namespace"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"defaultMode"</span>:420<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"containers"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-container"</span>,<span class="token string">"image"</span><span class="token builtin class-name">:</span><span class="token string">"nginx:1.21.4"</span>,<span class="token string">"resources"</span>:<span class="token punctuation">&#123;</span><span class="token string">"limits"</span>:<span class="token punctuation">&#123;</span><span class="token string">"cpu"</span><span class="token builtin class-name">:</span><span class="token string">"200m"</span>,<span class="token string">"memory"</span><span class="token builtin class-name">:</span><span class="token string">"200Mi"</span><span class="token punctuation">&#125;</span>,<span class="token string">"requests"</span>:<span class="token punctuation">&#123;</span><span class="token string">"cpu"</span><span class="token builtin class-name">:</span><span class="token string">"100m"</span>,<span class="token string">"memory"</span><span class="token builtin class-name">:</span><span class="token string">"100Mi"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"volumeMounts"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-api-access-7897x"</span>,<span class="token string">"readOnly"</span>:true,<span class="token string">"mountPath"</span><span class="token builtin class-name">:</span><span class="token string">"/var/run/secrets/kubernetes.io/serviceaccount"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"terminationMessagePath"</span><span class="token builtin class-name">:</span><span class="token string">"/dev/termination-log"</span>,<span class="token string">"terminationMessagePolicy"</span><span class="token builtin class-name">:</span><span class="token string">"File"</span>,<span class="token string">"imagePullPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"IfNotPresent"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"restartPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"Always"</span>,<span class="token string">"terminationGracePeriodSeconds"</span>:30,<span class="token string">"dnsPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"ClusterFirst"</span>,<span class="token string">"serviceAccountName"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"serviceAccount"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"securityContext"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"affinity"</span>:<span class="token punctuation">&#123;</span><span class="token string">"podAntiAffinity"</span>:<span class="token punctuation">&#123;</span><span class="token string">"requiredDuringSchedulingIgnoredDuringExecution"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"labelSelector"</span>:<span class="token punctuation">&#123;</span><span class="token string">"matchExpressions"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"app_type"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"In"</span>,<span class="token string">"values"</span>:<span class="token punctuation">[</span><span class="token string">"frontend"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>,<span class="token string">"topologyKey"</span><span class="token builtin class-name">:</span><span class="token string">"kubernetes.io/hostname"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"schedulerName"</span><span class="token builtin class-name">:</span><span class="token string">"default-scheduler"</span>,<span class="token string">"tolerations"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"node.kubernetes.io/not-ready"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"Exists"</span>,<span class="token string">"effect"</span><span class="token builtin class-name">:</span><span class="token string">"NoExecute"</span>,<span class="token string">"tolerationSeconds"</span>:300<span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"node.kubernetes.io/unreachable"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"Exists"</span>,<span class="token string">"effect"</span><span class="token builtin class-name">:</span><span class="token string">"NoExecute"</span>,<span class="token string">"tolerationSeconds"</span>:300<span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"priority"</span>:0,<span class="token string">"enableServiceLinks"</span>:true,<span class="token string">"preemptionPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"PreemptLowerPriority"</span><span class="token punctuation">&#125;</span>,<span class="token string">"status"</span>:<span class="token punctuation">&#123;</span><span class="token string">"phase"</span><span class="token builtin class-name">:</span><span class="token string">"Pending"</span>,<span class="token string">"qosClass"</span><span class="token builtin class-name">:</span><span class="token string">"Burstable"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"MODIFIED"</span>,<span class="token string">"object"</span>:<span class="token punctuation">&#123;</span><span class="token string">"kind"</span><span class="token builtin class-name">:</span><span class="token string">"Pod"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d-6fggw"</span>,<span class="token string">"generateName"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d-"</span>,<span class="token string">"namespace"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"uid"</span><span class="token builtin class-name">:</span><span class="token string">"4f6c6528-1fdd-4f9d-a66d-74a5ac7d4142"</span>,<span class="token string">"resourceVersion"</span><span class="token builtin class-name">:</span><span class="token string">"18130100"</span>,<span class="token string">"creationTimestamp"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"labels"</span>:<span class="token punctuation">&#123;</span><span class="token string">"app"</span><span class="token builtin class-name">:</span><span class="token string">"nginx"</span>,<span class="token string">"app_type"</span><span class="token builtin class-name">:</span><span class="token string">"frontend"</span>,<span class="token string">"pod-template-hash"</span><span class="token builtin class-name">:</span><span class="token string">"68544fd76d"</span><span class="token punctuation">&#125;</span>,<span class="token string">"ownerReferences"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"apps/v1"</span>,<span class="token string">"kind"</span><span class="token builtin class-name">:</span><span class="token string">"ReplicaSet"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d"</span>,<span class="token string">"uid"</span><span class="token builtin class-name">:</span><span class="token string">"8f979c58-c687-43d1-badb-83a258a467ea"</span>,<span class="token string">"controller"</span>:true,<span class="token string">"blockOwnerDeletion"</span>:true<span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"managedFields"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"manager"</span><span class="token builtin class-name">:</span><span class="token string">"kube-controller-manager"</span>,<span class="token string">"operation"</span><span class="token builtin class-name">:</span><span class="token string">"Update"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"time"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"fieldsType"</span><span class="token builtin class-name">:</span><span class="token string">"FieldsV1"</span>,<span class="token string">"fieldsV1"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:generateName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:labels"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:app"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:app_type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:pod-template-hash"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:ownerReferences"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>uid<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>8f979c58-c687-43d1-badb-83a258a467ea<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:spec"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:containers"</span>:<span class="token punctuation">&#123;</span><span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>name<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>nginx-container<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:image"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:imagePullPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:name"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:resources"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:limits"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cpu"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:memory"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:requests"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cpu"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:memory"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationMessagePath"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationMessagePolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:dnsPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:enableServiceLinks"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:restartPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:schedulerName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:securityContext"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:serviceAccount"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:serviceAccountName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationGracePeriodSeconds"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>,<span class="token string">"spec"</span>:<span class="token punctuation">&#123;</span><span class="token string">"volumes"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-api-access-7897x"</span>,<span class="token string">"projected"</span>:<span class="token punctuation">&#123;</span><span class="token string">"sources"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"serviceAccountToken"</span>:<span class="token punctuation">&#123;</span><span class="token string">"expirationSeconds"</span>:3607,<span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"token"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"configMap"</span>:<span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-root-ca.crt"</span>,<span class="token string">"items"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"ca.crt"</span>,<span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"ca.crt"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"downwardAPI"</span>:<span class="token punctuation">&#123;</span><span class="token string">"items"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"namespace"</span>,<span class="token string">"fieldRef"</span>:<span class="token punctuation">&#123;</span><span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"fieldPath"</span><span class="token builtin class-name">:</span><span class="token string">"metadata.namespace"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"defaultMode"</span>:420<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"containers"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-container"</span>,<span class="token string">"image"</span><span class="token builtin class-name">:</span><span class="token string">"nginx:1.21.4"</span>,<span class="token string">"resources"</span>:<span class="token punctuation">&#123;</span><span class="token string">"limits"</span>:<span class="token punctuation">&#123;</span><span class="token string">"cpu"</span><span class="token builtin class-name">:</span><span class="token string">"200m"</span>,<span class="token string">"memory"</span><span class="token builtin class-name">:</span><span class="token string">"200Mi"</span><span class="token punctuation">&#125;</span>,<span class="token string">"requests"</span>:<span class="token punctuation">&#123;</span><span class="token string">"cpu"</span><span class="token builtin class-name">:</span><span class="token string">"100m"</span>,<span class="token string">"memory"</span><span class="token builtin class-name">:</span><span class="token string">"100Mi"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"volumeMounts"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-api-access-7897x"</span>,<span class="token string">"readOnly"</span>:true,<span class="token string">"mountPath"</span><span class="token builtin class-name">:</span><span class="token string">"/var/run/secrets/kubernetes.io/serviceaccount"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"terminationMessagePath"</span><span class="token builtin class-name">:</span><span class="token string">"/dev/termination-log"</span>,<span class="token string">"terminationMessagePolicy"</span><span class="token builtin class-name">:</span><span class="token string">"File"</span>,<span class="token string">"imagePullPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"IfNotPresent"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"restartPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"Always"</span>,<span class="token string">"terminationGracePeriodSeconds"</span>:30,<span class="token string">"dnsPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"ClusterFirst"</span>,<span class="token string">"serviceAccountName"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"serviceAccount"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"nodeName"</span><span class="token builtin class-name">:</span><span class="token string">"k8s-node2.lab.example.com"</span>,<span class="token string">"securityContext"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"affinity"</span>:<span class="token punctuation">&#123;</span><span class="token string">"podAntiAffinity"</span>:<span class="token punctuation">&#123;</span><span class="token string">"requiredDuringSchedulingIgnoredDuringExecution"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"labelSelector"</span>:<span class="token punctuation">&#123;</span><span class="token string">"matchExpressions"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"app_type"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"In"</span>,<span class="token string">"values"</span>:<span class="token punctuation">[</span><span class="token string">"frontend"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>,<span class="token string">"topologyKey"</span><span class="token builtin class-name">:</span><span class="token string">"kubernetes.io/hostname"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"schedulerName"</span><span class="token builtin class-name">:</span><span class="token string">"default-scheduler"</span>,<span class="token string">"tolerations"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"node.kubernetes.io/not-ready"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"Exists"</span>,<span class="token string">"effect"</span><span class="token builtin class-name">:</span><span class="token string">"NoExecute"</span>,<span class="token string">"tolerationSeconds"</span>:300<span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"node.kubernetes.io/unreachable"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"Exists"</span>,<span class="token string">"effect"</span><span class="token builtin class-name">:</span><span class="token string">"NoExecute"</span>,<span class="token string">"tolerationSeconds"</span>:300<span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"priority"</span>:0,<span class="token string">"enableServiceLinks"</span>:true,<span class="token string">"preemptionPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"PreemptLowerPriority"</span><span class="token punctuation">&#125;</span>,<span class="token string">"status"</span>:<span class="token punctuation">&#123;</span><span class="token string">"phase"</span><span class="token builtin class-name">:</span><span class="token string">"Pending"</span>,<span class="token string">"conditions"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"PodScheduled"</span>,<span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"True"</span>,<span class="token string">"lastProbeTime"</span>:null,<span class="token string">"lastTransitionTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"qosClass"</span><span class="token builtin class-name">:</span><span class="token string">"Burstable"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"MODIFIED"</span>,<span class="token string">"object"</span>:<span class="token punctuation">&#123;</span><span class="token string">"kind"</span><span class="token builtin class-name">:</span><span class="token string">"Pod"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d-6fggw"</span>,<span class="token string">"generateName"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d-"</span>,<span class="token string">"namespace"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"uid"</span><span class="token builtin class-name">:</span><span class="token string">"4f6c6528-1fdd-4f9d-a66d-74a5ac7d4142"</span>,<span class="token string">"resourceVersion"</span><span class="token builtin class-name">:</span><span class="token string">"18130102"</span>,<span class="token string">"creationTimestamp"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"labels"</span>:<span class="token punctuation">&#123;</span><span class="token string">"app"</span><span class="token builtin class-name">:</span><span class="token string">"nginx"</span>,<span class="token string">"app_type"</span><span class="token builtin class-name">:</span><span class="token string">"frontend"</span>,<span class="token string">"pod-template-hash"</span><span class="token builtin class-name">:</span><span class="token string">"68544fd76d"</span><span class="token punctuation">&#125;</span>,<span class="token string">"ownerReferences"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"apps/v1"</span>,<span class="token string">"kind"</span><span class="token builtin class-name">:</span><span class="token string">"ReplicaSet"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d"</span>,<span class="token string">"uid"</span><span class="token builtin class-name">:</span><span class="token string">"8f979c58-c687-43d1-badb-83a258a467ea"</span>,<span class="token string">"controller"</span>:true,<span class="token string">"blockOwnerDeletion"</span>:true<span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"managedFields"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"manager"</span><span class="token builtin class-name">:</span><span class="token string">"Go-http-client"</span>,<span class="token string">"operation"</span><span class="token builtin class-name">:</span><span class="token string">"Update"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"time"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"fieldsType"</span><span class="token builtin class-name">:</span><span class="token string">"FieldsV1"</span>,<span class="token string">"fieldsV1"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:status"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:conditions"</span>:<span class="token punctuation">&#123;</span><span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>type<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>ContainersReady<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastProbeTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastTransitionTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:message"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:reason"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:status"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>type<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>Initialized<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastProbeTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastTransitionTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:status"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>type<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>Ready<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastProbeTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastTransitionTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:message"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:reason"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:status"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:containerStatuses"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:hostIP"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:startTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"subresource"</span><span class="token builtin class-name">:</span><span class="token string">"status"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"manager"</span><span class="token builtin class-name">:</span><span class="token string">"kube-controller-manager"</span>,<span class="token string">"operation"</span><span class="token builtin class-name">:</span><span class="token string">"Update"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"time"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"fieldsType"</span><span class="token builtin class-name">:</span><span class="token string">"FieldsV1"</span>,<span class="token string">"fieldsV1"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:generateName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:labels"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:app"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:app_type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:pod-template-hash"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:ownerReferences"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>uid<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>8f979c58-c687-43d1-badb-83a258a467ea<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:spec"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:containers"</span>:<span class="token punctuation">&#123;</span><span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>name<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>nginx-container<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:image"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:imagePullPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:name"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:resources"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:limits"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cpu"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:memory"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:requests"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cpu"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:memory"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationMessagePath"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationMessagePolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:dnsPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:enableServiceLinks"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:restartPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:schedulerName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:securityContext"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:serviceAccount"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:serviceAccountName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationGracePeriodSeconds"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>,<span class="token string">"spec"</span>:<span class="token punctuation">&#123;</span><span class="token string">"volumes"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-api-access-7897x"</span>,<span class="token string">"projected"</span>:<span class="token punctuation">&#123;</span><span class="token string">"sources"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"serviceAccountToken"</span>:<span class="token punctuation">&#123;</span><span class="token string">"expirationSeconds"</span>:3607,<span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"token"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"configMap"</span>:<span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-root-ca.crt"</span>,<span class="token string">"items"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"ca.crt"</span>,<span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"ca.crt"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"downwardAPI"</span>:<span class="token punctuation">&#123;</span><span class="token string">"items"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"namespace"</span>,<span class="token string">"fieldRef"</span>:<span class="token punctuation">&#123;</span><span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"fieldPath"</span><span class="token builtin class-name">:</span><span class="token string">"metadata.namespace"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"defaultMode"</span>:420<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"containers"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-container"</span>,<span class="token string">"image"</span><span class="token builtin class-name">:</span><span class="token string">"nginx:1.21.4"</span>,<span class="token string">"resources"</span>:<span class="token punctuation">&#123;</span><span class="token string">"limits"</span>:<span class="token punctuation">&#123;</span><span class="token string">"cpu"</span><span class="token builtin class-name">:</span><span class="token string">"200m"</span>,<span class="token string">"memory"</span><span class="token builtin class-name">:</span><span class="token string">"200Mi"</span><span class="token punctuation">&#125;</span>,<span class="token string">"requests"</span>:<span class="token punctuation">&#123;</span><span class="token string">"cpu"</span><span class="token builtin class-name">:</span><span class="token string">"100m"</span>,<span class="token string">"memory"</span><span class="token builtin class-name">:</span><span class="token string">"100Mi"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"volumeMounts"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-api-access-7897x"</span>,<span class="token string">"readOnly"</span>:true,<span class="token string">"mountPath"</span><span class="token builtin class-name">:</span><span class="token string">"/var/run/secrets/kubernetes.io/serviceaccount"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"terminationMessagePath"</span><span class="token builtin class-name">:</span><span class="token string">"/dev/termination-log"</span>,<span class="token string">"terminationMessagePolicy"</span><span class="token builtin class-name">:</span><span class="token string">"File"</span>,<span class="token string">"imagePullPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"IfNotPresent"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"restartPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"Always"</span>,<span class="token string">"terminationGracePeriodSeconds"</span>:30,<span class="token string">"dnsPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"ClusterFirst"</span>,<span class="token string">"serviceAccountName"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"serviceAccount"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"nodeName"</span><span class="token builtin class-name">:</span><span class="token string">"k8s-node2.lab.example.com"</span>,<span class="token string">"securityContext"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"affinity"</span>:<span class="token punctuation">&#123;</span><span class="token string">"podAntiAffinity"</span>:<span class="token punctuation">&#123;</span><span class="token string">"requiredDuringSchedulingIgnoredDuringExecution"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"labelSelector"</span>:<span class="token punctuation">&#123;</span><span class="token string">"matchExpressions"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"app_type"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"In"</span>,<span class="token string">"values"</span>:<span class="token punctuation">[</span><span class="token string">"frontend"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>,<span class="token string">"topologyKey"</span><span class="token builtin class-name">:</span><span class="token string">"kubernetes.io/hostname"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"schedulerName"</span><span class="token builtin class-name">:</span><span class="token string">"default-scheduler"</span>,<span class="token string">"tolerations"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"node.kubernetes.io/not-ready"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"Exists"</span>,<span class="token string">"effect"</span><span class="token builtin class-name">:</span><span class="token string">"NoExecute"</span>,<span class="token string">"tolerationSeconds"</span>:300<span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"node.kubernetes.io/unreachable"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"Exists"</span>,<span class="token string">"effect"</span><span class="token builtin class-name">:</span><span class="token string">"NoExecute"</span>,<span class="token string">"tolerationSeconds"</span>:300<span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"priority"</span>:0,<span class="token string">"enableServiceLinks"</span>:true,<span class="token string">"preemptionPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"PreemptLowerPriority"</span><span class="token punctuation">&#125;</span>,<span class="token string">"status"</span>:<span class="token punctuation">&#123;</span><span class="token string">"phase"</span><span class="token builtin class-name">:</span><span class="token string">"Pending"</span>,<span class="token string">"conditions"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"Initialized"</span>,<span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"True"</span>,<span class="token string">"lastProbeTime"</span>:null,<span class="token string">"lastTransitionTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"Ready"</span>,<span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"False"</span>,<span class="token string">"lastProbeTime"</span>:null,<span class="token string">"lastTransitionTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"reason"</span><span class="token builtin class-name">:</span><span class="token string">"ContainersNotReady"</span>,<span class="token string">"message"</span><span class="token builtin class-name">:</span><span class="token string">"containers with unready status: [nginx-container]"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"ContainersReady"</span>,<span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"False"</span>,<span class="token string">"lastProbeTime"</span>:null,<span class="token string">"lastTransitionTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"reason"</span><span class="token builtin class-name">:</span><span class="token string">"ContainersNotReady"</span>,<span class="token string">"message"</span><span class="token builtin class-name">:</span><span class="token string">"containers with unready status: [nginx-container]"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"PodScheduled"</span>,<span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"True"</span>,<span class="token string">"lastProbeTime"</span>:null,<span class="token string">"lastTransitionTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"hostIP"</span><span class="token builtin class-name">:</span><span class="token string">"192.168.126.102"</span>,<span class="token string">"startTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"containerStatuses"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-container"</span>,<span class="token string">"state"</span>:<span class="token punctuation">&#123;</span><span class="token string">"waiting"</span>:<span class="token punctuation">&#123;</span><span class="token string">"reason"</span><span class="token builtin class-name">:</span><span class="token string">"ContainerCreating"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"lastState"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"ready"</span>:false,<span class="token string">"restartCount"</span>:0,<span class="token string">"image"</span><span class="token builtin class-name">:</span><span class="token string">"nginx:1.21.4"</span>,<span class="token string">"imageID"</span><span class="token builtin class-name">:</span><span class="token string">""</span>,<span class="token string">"started"</span>:false<span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"qosClass"</span><span class="token builtin class-name">:</span><span class="token string">"Burstable"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"MODIFIED"</span>,<span class="token string">"object"</span>:<span class="token punctuation">&#123;</span><span class="token string">"kind"</span><span class="token builtin class-name">:</span><span class="token string">"Pod"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d-6fggw"</span>,<span class="token string">"generateName"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d-"</span>,<span class="token string">"namespace"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"uid"</span><span class="token builtin class-name">:</span><span class="token string">"4f6c6528-1fdd-4f9d-a66d-74a5ac7d4142"</span>,<span class="token string">"resourceVersion"</span><span class="token builtin class-name">:</span><span class="token string">"18130114"</span>,<span class="token string">"creationTimestamp"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"labels"</span>:<span class="token punctuation">&#123;</span><span class="token string">"app"</span><span class="token builtin class-name">:</span><span class="token string">"nginx"</span>,<span class="token string">"app_type"</span><span class="token builtin class-name">:</span><span class="token string">"frontend"</span>,<span class="token string">"pod-template-hash"</span><span class="token builtin class-name">:</span><span class="token string">"68544fd76d"</span><span class="token punctuation">&#125;</span>,<span class="token string">"annotations"</span>:<span class="token punctuation">&#123;</span><span class="token string">"cni.projectcalico.org/containerID"</span><span class="token builtin class-name">:</span><span class="token string">"9e115a5d84568ea17e39a8c7cc7ca1fe8ec7e1be88882633a423f89cb175e338"</span>,<span class="token string">"cni.projectcalico.org/podIP"</span><span class="token builtin class-name">:</span><span class="token string">"10.244.123.176/32"</span>,<span class="token string">"cni.projectcalico.org/podIPs"</span><span class="token builtin class-name">:</span><span class="token string">"10.244.123.176/32"</span><span class="token punctuation">&#125;</span>,<span class="token string">"ownerReferences"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"apps/v1"</span>,<span class="token string">"kind"</span><span class="token builtin class-name">:</span><span class="token string">"ReplicaSet"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d"</span>,<span class="token string">"uid"</span><span class="token builtin class-name">:</span><span class="token string">"8f979c58-c687-43d1-badb-83a258a467ea"</span>,<span class="token string">"controller"</span>:true,<span class="token string">"blockOwnerDeletion"</span>:true<span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"managedFields"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"manager"</span><span class="token builtin class-name">:</span><span class="token string">"Go-http-client"</span>,<span class="token string">"operation"</span><span class="token builtin class-name">:</span><span class="token string">"Update"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"time"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"fieldsType"</span><span class="token builtin class-name">:</span><span class="token string">"FieldsV1"</span>,<span class="token string">"fieldsV1"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:status"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:conditions"</span>:<span class="token punctuation">&#123;</span><span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>type<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>ContainersReady<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastProbeTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastTransitionTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:message"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:reason"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:status"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>type<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>Initialized<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastProbeTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastTransitionTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:status"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>type<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>Ready<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastProbeTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastTransitionTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:message"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:reason"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:status"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:containerStatuses"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:hostIP"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:startTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"subresource"</span><span class="token builtin class-name">:</span><span class="token string">"status"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"manager"</span><span class="token builtin class-name">:</span><span class="token string">"kube-controller-manager"</span>,<span class="token string">"operation"</span><span class="token builtin class-name">:</span><span class="token string">"Update"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"time"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"fieldsType"</span><span class="token builtin class-name">:</span><span class="token string">"FieldsV1"</span>,<span class="token string">"fieldsV1"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:generateName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:labels"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:app"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:app_type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:pod-template-hash"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:ownerReferences"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>uid<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>8f979c58-c687-43d1-badb-83a258a467ea<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:spec"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:containers"</span>:<span class="token punctuation">&#123;</span><span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>name<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>nginx-container<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:image"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:imagePullPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:name"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:resources"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:limits"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cpu"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:memory"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:requests"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cpu"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:memory"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationMessagePath"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationMessagePolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:dnsPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:enableServiceLinks"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:restartPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:schedulerName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:securityContext"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:serviceAccount"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:serviceAccountName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationGracePeriodSeconds"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"manager"</span><span class="token builtin class-name">:</span><span class="token string">"calico"</span>,<span class="token string">"operation"</span><span class="token builtin class-name">:</span><span class="token string">"Update"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"time"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:54Z"</span>,<span class="token string">"fieldsType"</span><span class="token builtin class-name">:</span><span class="token string">"FieldsV1"</span>,<span class="token string">"fieldsV1"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:annotations"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cni.projectcalico.org/containerID"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cni.projectcalico.org/podIP"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cni.projectcalico.org/podIPs"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"subresource"</span><span class="token builtin class-name">:</span><span class="token string">"status"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>,<span class="token string">"spec"</span>:<span class="token punctuation">&#123;</span><span class="token string">"volumes"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-api-access-7897x"</span>,<span class="token string">"projected"</span>:<span class="token punctuation">&#123;</span><span class="token string">"sources"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"serviceAccountToken"</span>:<span class="token punctuation">&#123;</span><span class="token string">"expirationSeconds"</span>:3607,<span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"token"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"configMap"</span>:<span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-root-ca.crt"</span>,<span class="token string">"items"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"ca.crt"</span>,<span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"ca.crt"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"downwardAPI"</span>:<span class="token punctuation">&#123;</span><span class="token string">"items"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"namespace"</span>,<span class="token string">"fieldRef"</span>:<span class="token punctuation">&#123;</span><span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"fieldPath"</span><span class="token builtin class-name">:</span><span class="token string">"metadata.namespace"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"defaultMode"</span>:420<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"containers"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-container"</span>,<span class="token string">"image"</span><span class="token builtin class-name">:</span><span class="token string">"nginx:1.21.4"</span>,<span class="token string">"resources"</span>:<span class="token punctuation">&#123;</span><span class="token string">"limits"</span>:<span class="token punctuation">&#123;</span><span class="token string">"cpu"</span><span class="token builtin class-name">:</span><span class="token string">"200m"</span>,<span class="token string">"memory"</span><span class="token builtin class-name">:</span><span class="token string">"200Mi"</span><span class="token punctuation">&#125;</span>,<span class="token string">"requests"</span>:<span class="token punctuation">&#123;</span><span class="token string">"cpu"</span><span class="token builtin class-name">:</span><span class="token string">"100m"</span>,<span class="token string">"memory"</span><span class="token builtin class-name">:</span><span class="token string">"100Mi"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"volumeMounts"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-api-access-7897x"</span>,<span class="token string">"readOnly"</span>:true,<span class="token string">"mountPath"</span><span class="token builtin class-name">:</span><span class="token string">"/var/run/secrets/kubernetes.io/serviceaccount"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"terminationMessagePath"</span><span class="token builtin class-name">:</span><span class="token string">"/dev/termination-log"</span>,<span class="token string">"terminationMessagePolicy"</span><span class="token builtin class-name">:</span><span class="token string">"File"</span>,<span class="token string">"imagePullPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"IfNotPresent"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"restartPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"Always"</span>,<span class="token string">"terminationGracePeriodSeconds"</span>:30,<span class="token string">"dnsPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"ClusterFirst"</span>,<span class="token string">"serviceAccountName"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"serviceAccount"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"nodeName"</span><span class="token builtin class-name">:</span><span class="token string">"k8s-node2.lab.example.com"</span>,<span class="token string">"securityContext"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"affinity"</span>:<span class="token punctuation">&#123;</span><span class="token string">"podAntiAffinity"</span>:<span class="token punctuation">&#123;</span><span class="token string">"requiredDuringSchedulingIgnoredDuringExecution"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"labelSelector"</span>:<span class="token punctuation">&#123;</span><span class="token string">"matchExpressions"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"app_type"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"In"</span>,<span class="token string">"values"</span>:<span class="token punctuation">[</span><span class="token string">"frontend"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>,<span class="token string">"topologyKey"</span><span class="token builtin class-name">:</span><span class="token string">"kubernetes.io/hostname"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"schedulerName"</span><span class="token builtin class-name">:</span><span class="token string">"default-scheduler"</span>,<span class="token string">"tolerations"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"node.kubernetes.io/not-ready"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"Exists"</span>,<span class="token string">"effect"</span><span class="token builtin class-name">:</span><span class="token string">"NoExecute"</span>,<span class="token string">"tolerationSeconds"</span>:300<span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"node.kubernetes.io/unreachable"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"Exists"</span>,<span class="token string">"effect"</span><span class="token builtin class-name">:</span><span class="token string">"NoExecute"</span>,<span class="token string">"tolerationSeconds"</span>:300<span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"priority"</span>:0,<span class="token string">"enableServiceLinks"</span>:true,<span class="token string">"preemptionPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"PreemptLowerPriority"</span><span class="token punctuation">&#125;</span>,<span class="token string">"status"</span>:<span class="token punctuation">&#123;</span><span class="token string">"phase"</span><span class="token builtin class-name">:</span><span class="token string">"Pending"</span>,<span class="token string">"conditions"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"Initialized"</span>,<span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"True"</span>,<span class="token string">"lastProbeTime"</span>:null,<span class="token string">"lastTransitionTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"Ready"</span>,<span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"False"</span>,<span class="token string">"lastProbeTime"</span>:null,<span class="token string">"lastTransitionTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"reason"</span><span class="token builtin class-name">:</span><span class="token string">"ContainersNotReady"</span>,<span class="token string">"message"</span><span class="token builtin class-name">:</span><span class="token string">"containers with unready status: [nginx-container]"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"ContainersReady"</span>,<span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"False"</span>,<span class="token string">"lastProbeTime"</span>:null,<span class="token string">"lastTransitionTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"reason"</span><span class="token builtin class-name">:</span><span class="token string">"ContainersNotReady"</span>,<span class="token string">"message"</span><span class="token builtin class-name">:</span><span class="token string">"containers with unready status: [nginx-container]"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"PodScheduled"</span>,<span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"True"</span>,<span class="token string">"lastProbeTime"</span>:null,<span class="token string">"lastTransitionTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"hostIP"</span><span class="token builtin class-name">:</span><span class="token string">"192.168.126.102"</span>,<span class="token string">"startTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"containerStatuses"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-container"</span>,<span class="token string">"state"</span>:<span class="token punctuation">&#123;</span><span class="token string">"waiting"</span>:<span class="token punctuation">&#123;</span><span class="token string">"reason"</span><span class="token builtin class-name">:</span><span class="token string">"ContainerCreating"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"lastState"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"ready"</span>:false,<span class="token string">"restartCount"</span>:0,<span class="token string">"image"</span><span class="token builtin class-name">:</span><span class="token string">"nginx:1.21.4"</span>,<span class="token string">"imageID"</span><span class="token builtin class-name">:</span><span class="token string">""</span>,<span class="token string">"started"</span>:false<span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"qosClass"</span><span class="token builtin class-name">:</span><span class="token string">"Burstable"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"DELETED"</span>,<span class="token string">"object"</span>:<span class="token punctuation">&#123;</span><span class="token string">"kind"</span><span class="token builtin class-name">:</span><span class="token string">"Pod"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d-6fggw"</span>,<span class="token string">"generateName"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d-"</span>,<span class="token string">"namespace"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"uid"</span><span class="token builtin class-name">:</span><span class="token string">"4f6c6528-1fdd-4f9d-a66d-74a5ac7d4142"</span>,<span class="token string">"resourceVersion"</span><span class="token builtin class-name">:</span><span class="token string">"18130238"</span>,<span class="token string">"creationTimestamp"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"deletionTimestamp"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:36:41Z"</span>,<span class="token string">"deletionGracePeriodSeconds"</span>:0,<span class="token string">"labels"</span>:<span class="token punctuation">&#123;</span><span class="token string">"app"</span><span class="token builtin class-name">:</span><span class="token string">"nginx"</span>,<span class="token string">"app_type"</span><span class="token builtin class-name">:</span><span class="token string">"frontend"</span>,<span class="token string">"pod-template-hash"</span><span class="token builtin class-name">:</span><span class="token string">"68544fd76d"</span><span class="token punctuation">&#125;</span>,<span class="token string">"annotations"</span>:<span class="token punctuation">&#123;</span><span class="token string">"cni.projectcalico.org/containerID"</span><span class="token builtin class-name">:</span><span class="token string">"9e115a5d84568ea17e39a8c7cc7ca1fe8ec7e1be88882633a423f89cb175e338"</span>,<span class="token string">"cni.projectcalico.org/podIP"</span><span class="token builtin class-name">:</span><span class="token string">""</span>,<span class="token string">"cni.projectcalico.org/podIPs"</span><span class="token builtin class-name">:</span><span class="token string">""</span><span class="token punctuation">&#125;</span>,<span class="token string">"ownerReferences"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"apps/v1"</span>,<span class="token string">"kind"</span><span class="token builtin class-name">:</span><span class="token string">"ReplicaSet"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-68544fd76d"</span>,<span class="token string">"uid"</span><span class="token builtin class-name">:</span><span class="token string">"8f979c58-c687-43d1-badb-83a258a467ea"</span>,<span class="token string">"controller"</span>:true,<span class="token string">"blockOwnerDeletion"</span>:true<span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"managedFields"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"manager"</span><span class="token builtin class-name">:</span><span class="token string">"kube-controller-manager"</span>,<span class="token string">"operation"</span><span class="token builtin class-name">:</span><span class="token string">"Update"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"time"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"fieldsType"</span><span class="token builtin class-name">:</span><span class="token string">"FieldsV1"</span>,<span class="token string">"fieldsV1"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:generateName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:labels"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:app"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:app_type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:pod-template-hash"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:ownerReferences"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>uid<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>8f979c58-c687-43d1-badb-83a258a467ea<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:spec"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:containers"</span>:<span class="token punctuation">&#123;</span><span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>name<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>nginx-container<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:image"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:imagePullPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:name"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:resources"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:limits"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cpu"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:memory"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:requests"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cpu"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:memory"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationMessagePath"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationMessagePolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:dnsPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:enableServiceLinks"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:restartPolicy"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:schedulerName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:securityContext"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:serviceAccount"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:serviceAccountName"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:terminationGracePeriodSeconds"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"manager"</span><span class="token builtin class-name">:</span><span class="token string">"calico"</span>,<span class="token string">"operation"</span><span class="token builtin class-name">:</span><span class="token string">"Update"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"time"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:54Z"</span>,<span class="token string">"fieldsType"</span><span class="token builtin class-name">:</span><span class="token string">"FieldsV1"</span>,<span class="token string">"fieldsV1"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:metadata"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:annotations"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cni.projectcalico.org/containerID"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cni.projectcalico.org/podIP"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:cni.projectcalico.org/podIPs"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"subresource"</span><span class="token builtin class-name">:</span><span class="token string">"status"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"manager"</span><span class="token builtin class-name">:</span><span class="token string">"Go-http-client"</span>,<span class="token string">"operation"</span><span class="token builtin class-name">:</span><span class="token string">"Update"</span>,<span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"time"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:36:43Z"</span>,<span class="token string">"fieldsType"</span><span class="token builtin class-name">:</span><span class="token string">"FieldsV1"</span>,<span class="token string">"fieldsV1"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:status"</span>:<span class="token punctuation">&#123;</span><span class="token string">"f:conditions"</span>:<span class="token punctuation">&#123;</span><span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>type<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>ContainersReady<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastProbeTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastTransitionTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:message"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:reason"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:status"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>type<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>Initialized<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastProbeTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastTransitionTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:status"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"k:&#123;<span class="token entity" title="\&quot;">\"</span>type<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>Ready<span class="token entity" title="\&quot;">\"</span>&#125;"</span>:<span class="token punctuation">&#123;</span><span class="token string">"."</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastProbeTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:lastTransitionTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:message"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:reason"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:status"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:type"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:containerStatuses"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:hostIP"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:phase"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"f:startTime"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"subresource"</span><span class="token builtin class-name">:</span><span class="token string">"status"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>,<span class="token string">"spec"</span>:<span class="token punctuation">&#123;</span><span class="token string">"volumes"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-api-access-7897x"</span>,<span class="token string">"projected"</span>:<span class="token punctuation">&#123;</span><span class="token string">"sources"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"serviceAccountToken"</span>:<span class="token punctuation">&#123;</span><span class="token string">"expirationSeconds"</span>:3607,<span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"token"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"configMap"</span>:<span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-root-ca.crt"</span>,<span class="token string">"items"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"ca.crt"</span>,<span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"ca.crt"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"downwardAPI"</span>:<span class="token punctuation">&#123;</span><span class="token string">"items"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"path"</span><span class="token builtin class-name">:</span><span class="token string">"namespace"</span>,<span class="token string">"fieldRef"</span>:<span class="token punctuation">&#123;</span><span class="token string">"apiVersion"</span><span class="token builtin class-name">:</span><span class="token string">"v1"</span>,<span class="token string">"fieldPath"</span><span class="token builtin class-name">:</span><span class="token string">"metadata.namespace"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"defaultMode"</span>:420<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"containers"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-container"</span>,<span class="token string">"image"</span><span class="token builtin class-name">:</span><span class="token string">"nginx:1.21.4"</span>,<span class="token string">"resources"</span>:<span class="token punctuation">&#123;</span><span class="token string">"limits"</span>:<span class="token punctuation">&#123;</span><span class="token string">"cpu"</span><span class="token builtin class-name">:</span><span class="token string">"200m"</span>,<span class="token string">"memory"</span><span class="token builtin class-name">:</span><span class="token string">"200Mi"</span><span class="token punctuation">&#125;</span>,<span class="token string">"requests"</span>:<span class="token punctuation">&#123;</span><span class="token string">"cpu"</span><span class="token builtin class-name">:</span><span class="token string">"100m"</span>,<span class="token string">"memory"</span><span class="token builtin class-name">:</span><span class="token string">"100Mi"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"volumeMounts"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"kube-api-access-7897x"</span>,<span class="token string">"readOnly"</span>:true,<span class="token string">"mountPath"</span><span class="token builtin class-name">:</span><span class="token string">"/var/run/secrets/kubernetes.io/serviceaccount"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"terminationMessagePath"</span><span class="token builtin class-name">:</span><span class="token string">"/dev/termination-log"</span>,<span class="token string">"terminationMessagePolicy"</span><span class="token builtin class-name">:</span><span class="token string">"File"</span>,<span class="token string">"imagePullPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"IfNotPresent"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"restartPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"Always"</span>,<span class="token string">"terminationGracePeriodSeconds"</span>:30,<span class="token string">"dnsPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"ClusterFirst"</span>,<span class="token string">"serviceAccountName"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"serviceAccount"</span><span class="token builtin class-name">:</span><span class="token string">"default"</span>,<span class="token string">"nodeName"</span><span class="token builtin class-name">:</span><span class="token string">"k8s-node2.lab.example.com"</span>,<span class="token string">"securityContext"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"affinity"</span>:<span class="token punctuation">&#123;</span><span class="token string">"podAntiAffinity"</span>:<span class="token punctuation">&#123;</span><span class="token string">"requiredDuringSchedulingIgnoredDuringExecution"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"labelSelector"</span>:<span class="token punctuation">&#123;</span><span class="token string">"matchExpressions"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"app_type"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"In"</span>,<span class="token string">"values"</span>:<span class="token punctuation">[</span><span class="token string">"frontend"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>,<span class="token string">"topologyKey"</span><span class="token builtin class-name">:</span><span class="token string">"kubernetes.io/hostname"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"schedulerName"</span><span class="token builtin class-name">:</span><span class="token string">"default-scheduler"</span>,<span class="token string">"tolerations"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"node.kubernetes.io/not-ready"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"Exists"</span>,<span class="token string">"effect"</span><span class="token builtin class-name">:</span><span class="token string">"NoExecute"</span>,<span class="token string">"tolerationSeconds"</span>:300<span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"key"</span><span class="token builtin class-name">:</span><span class="token string">"node.kubernetes.io/unreachable"</span>,<span class="token string">"operator"</span><span class="token builtin class-name">:</span><span class="token string">"Exists"</span>,<span class="token string">"effect"</span><span class="token builtin class-name">:</span><span class="token string">"NoExecute"</span>,<span class="token string">"tolerationSeconds"</span>:300<span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"priority"</span>:0,<span class="token string">"enableServiceLinks"</span>:true,<span class="token string">"preemptionPolicy"</span><span class="token builtin class-name">:</span><span class="token string">"PreemptLowerPriority"</span><span class="token punctuation">&#125;</span>,<span class="token string">"status"</span>:<span class="token punctuation">&#123;</span><span class="token string">"phase"</span><span class="token builtin class-name">:</span><span class="token string">"Running"</span>,<span class="token string">"conditions"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"Initialized"</span>,<span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"True"</span>,<span class="token string">"lastProbeTime"</span>:null,<span class="token string">"lastTransitionTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"Ready"</span>,<span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"False"</span>,<span class="token string">"lastProbeTime"</span>:null,<span class="token string">"lastTransitionTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:36:43Z"</span>,<span class="token string">"reason"</span><span class="token builtin class-name">:</span><span class="token string">"ContainersNotReady"</span>,<span class="token string">"message"</span><span class="token builtin class-name">:</span><span class="token string">"containers with unready status: [nginx-container]"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"ContainersReady"</span>,<span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"False"</span>,<span class="token string">"lastProbeTime"</span>:null,<span class="token string">"lastTransitionTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:36:43Z"</span>,<span class="token string">"reason"</span><span class="token builtin class-name">:</span><span class="token string">"ContainersNotReady"</span>,<span class="token string">"message"</span><span class="token builtin class-name">:</span><span class="token string">"containers with unready status: [nginx-container]"</span><span class="token punctuation">&#125;</span>,<span class="token punctuation">&#123;</span><span class="token string">"type"</span><span class="token builtin class-name">:</span><span class="token string">"PodScheduled"</span>,<span class="token string">"status"</span><span class="token builtin class-name">:</span><span class="token string">"True"</span>,<span class="token string">"lastProbeTime"</span>:null,<span class="token string">"lastTransitionTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"hostIP"</span><span class="token builtin class-name">:</span><span class="token string">"192.168.126.102"</span>,<span class="token string">"startTime"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:49Z"</span>,<span class="token string">"containerStatuses"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"nginx-container"</span>,<span class="token string">"state"</span>:<span class="token punctuation">&#123;</span><span class="token string">"terminated"</span>:<span class="token punctuation">&#123;</span><span class="token string">"exitCode"</span>:0,<span class="token string">"reason"</span><span class="token builtin class-name">:</span><span class="token string">"Completed"</span>,<span class="token string">"startedAt"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:35:55Z"</span>,<span class="token string">"finishedAt"</span><span class="token builtin class-name">:</span><span class="token string">"2023-12-15T07:36:41Z"</span>,<span class="token string">"containerID"</span><span class="token builtin class-name">:</span><span class="token string">"docker://08b4792466758680744919ec235c8c5934b92182c548e431c1e465df0c85428d"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>,<span class="token string">"lastState"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,<span class="token string">"ready"</span>:false,<span class="token string">"restartCount"</span>:0,<span class="token string">"image"</span><span class="token builtin class-name">:</span><span class="token string">"nginx:1.21.4"</span>,<span class="token string">"imageID"</span><span class="token builtin class-name">:</span><span class="token string">"docker-pullable://nginx@sha256:366e9f1ddebdb844044c2fafd13b75271a9f620819370f8971220c2b330a9254"</span>,<span class="token string">"containerID"</span><span class="token builtin class-name">:</span><span class="token string">"docker://08b4792466758680744919ec235c8c5934b92182c548e431c1e465df0c85428d"</span>,<span class="token string">"started"</span>:false<span class="token punctuation">&#125;</span><span class="token punctuation">]</span>,<span class="token string">"qosClass"</span><span class="token builtin class-name">:</span><span class="token string">"Burstable"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>从上面HTTP Watch返回的Response中，可以看到有三种类型的事件：ADDED，MODIFIED和DELETED。ADDED表示创建了新的Pod，Pod的状态变化会产生MODIFIED类型的事件，DELETED则表示Pod被删除。</p>
<p>我们可以用client-go编写一个简易的Watch功能。</p>
<h2 id="实现一个简易的Watch">实现一个简易的Watch</h2>
<pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"context"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"os"</span>
	<span class="token string">"time"</span>

	<span class="token string">"github.com/zeromicro/go-zero/core/logx"</span>
	corev1 <span class="token string">"k8s.io/api/core/v1"</span>
	metav1 <span class="token string">"k8s.io/apimachinery/pkg/apis/meta/v1"</span>
	ktypes <span class="token string">"k8s.io/apimachinery/pkg/types"</span>
	<span class="token string">"k8s.io/apimachinery/pkg/watch"</span>
	<span class="token string">"k8s.io/client-go/kubernetes"</span>
	<span class="token string">"k8s.io/client-go/rest"</span>
	<span class="token string">"k8s.io/client-go/tools/clientcmd"</span>
	<span class="token string">"k8s.io/client-go/util/flowcontrol"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> environment <span class="token operator">=</span> <span class="token string">"local"</span>
<span class="token keyword">var</span> kubeconfig <span class="token operator">=</span> <span class="token string">"./kubeconfig"</span>

<span class="token keyword">func</span> <span class="token function">createKubernetes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>kubernetes<span class="token punctuation">.</span>Clientset <span class="token punctuation">&#123;</span>
	logx<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">"Using namespace=default"</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> conf <span class="token operator">*</span>rest<span class="token punctuation">.</span>Config
	<span class="token keyword">var</span> err <span class="token builtin">error</span>
	<span class="token keyword">if</span> environment <span class="token operator">==</span> <span class="token string">"local"</span> <span class="token punctuation">&#123;</span>
		logx<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">"Using kubeconfig=%s"</span><span class="token punctuation">,</span> kubeconfig<span class="token punctuation">)</span>
		conf<span class="token punctuation">,</span> err <span class="token operator">=</span> clientcmd<span class="token punctuation">.</span><span class="token function">BuildConfigFromFlags</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> kubeconfig<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		logx<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">"Using serviceaccount=default"</span><span class="token punctuation">)</span>
		conf<span class="token punctuation">,</span> err <span class="token operator">=</span> rest<span class="token punctuation">.</span><span class="token function">InClusterConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		conf<span class="token punctuation">.</span>RateLimiter <span class="token operator">=</span> flowcontrol<span class="token punctuation">.</span><span class="token function">NewTokenBucketRateLimiter</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// setting a big ratelimiter for client-side throttling, default 5</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		logx<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	clientset<span class="token punctuation">,</span> err <span class="token operator">:=</span> kubernetes<span class="token punctuation">.</span><span class="token function">NewForConfig</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		logx<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> clientset
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	clientset <span class="token operator">:=</span> <span class="token function">createKubernetes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// watch for changes to pods</span>
	watcher<span class="token punctuation">,</span> err <span class="token operator">:=</span> clientset<span class="token punctuation">.</span><span class="token function">CoreV1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pods</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Watch</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> metav1<span class="token punctuation">.</span>ListOptions<span class="token punctuation">&#123;</span>
		LabelSelector<span class="token punctuation">:</span> <span class="token string">"app=nginx"</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">// loop through events from the watcher</span>
	<span class="token keyword">for</span> event <span class="token operator">:=</span> <span class="token keyword">range</span> watcher<span class="token punctuation">.</span><span class="token function">ResultChan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		pod <span class="token operator">:=</span> event<span class="token punctuation">.</span>Object<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>corev1<span class="token punctuation">.</span>Pod<span class="token punctuation">)</span>
		<span class="token keyword">switch</span> event<span class="token punctuation">.</span>Type <span class="token punctuation">&#123;</span>
		<span class="token keyword">case</span> watch<span class="token punctuation">.</span>Added<span class="token punctuation">:</span>
			logx<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">"Pod %s added, current status is %s \n"</span><span class="token punctuation">,</span> pod<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> pod<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Phase<span class="token punctuation">)</span>
			<span class="token comment">// todo: reconcile logic goes here</span>
		<span class="token keyword">case</span> watch<span class="token punctuation">.</span>Modified<span class="token punctuation">:</span>
			logx<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">"Pod %s modified, current status is %s \n"</span><span class="token punctuation">,</span> pod<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> pod<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Phase<span class="token punctuation">)</span>
			<span class="token comment">// todo: reconcile logic goes here</span>
			<span class="token keyword">if</span> pod<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Phase <span class="token operator">==</span> <span class="token string">"Running"</span> <span class="token punctuation">&#123;</span>
				data <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">`&#123;"spec":&#123;"template":&#123;"metadata":&#123;"annotations":&#123;"kubectl.kubernetes.io/restartedAt":"%s"&#125;&#125;&#125;&#125;&#125;`</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02T15:04:05Z"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> clientset<span class="token punctuation">.</span><span class="token function">AppsV1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Deployments</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Patch</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"tools"</span><span class="token punctuation">,</span> ktypes<span class="token punctuation">.</span>StrategicMergePatchType<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> metav1<span class="token punctuation">.</span>PatchOptions<span class="token punctuation">&#123;</span>FieldManager<span class="token punctuation">:</span> <span class="token string">"kubectl-rollout"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
				<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
					logx<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
				<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
					logx<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">"Restart tools success"</span><span class="token punctuation">)</span>
				<span class="token punctuation">&#125;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token keyword">case</span> watch<span class="token punctuation">.</span>Deleted<span class="token punctuation">:</span>
			logx<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">"Pod %s deleted \n"</span><span class="token punctuation">,</span> pod<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
			<span class="token comment">// todo: reconcile logic goes here</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>本例中监视的是app=nginx的Pod，主要的监听逻辑在<code>watcher.ResultChan()</code>。例子中实现了当Pod被修改后，并且处于<code>Running</code>状态时，重新启动<code>tools</code>这个deployment。</p>
<h2 id="K8S-Informer原理">K8S Informer原理</h2>
<p>采用K8S HTTP API可以查询K8S API资源对象并Watch其变化，但大量的HTTP调用会对Apiserver造成较大的负荷，而且网络调用可能存在较大的延迟。除此之外，开发者还需要在程序中处理资源的缓存，HTTP连接出问题后的重连等。为了解决这些问题并简化Controller的开发工作，K8S在client-go中提供了Informer客户端库。</p>
<p>在 Kubernetes中，Informer是一个客户端库，用于监视Kubernetes API服务器中的资源并将它们的当前状态缓存到本地。Informer提供了一种方法，让客户端应用程序可以高效地监视资源的更改，而无需不断地向 API 服务器发出请求。</p>
<p>相比直接采用HTTP Watch，使用 Kubernetes Informer有以下优势：</p>
<ul>
<li>减少API服务器的负载：通过在本地缓存资源信息，Informer减少了需要向API服务器发出的请求数量。这可以防止由于API服务器过载而影响整个集群的性能。</li>
<li>提高应用程序性能：使用缓存的数据，客户端应用程序可以快速访问资源信息，而无需等待API服务器响应。这可以提高应用程序性能并减少延迟。</li>
<li>简化代码：Informer提供了一种更简单、更流畅的方式来监视 Kubernetes 中的资源更改。客户端应用程序可以使用现有的Informer库来处理这些任务，而无需编写复杂的代码来管理与API服务器的连接并处理更新。</li>
<li>更高的可靠性：由于Informer在本地缓存数据，因此即使API服务器不可用或存在问题，它们也可以继续工作。这可以确保客户端应用程序即使在底层Kubernetes基础结构出现问题时也能保持功能。</li>
</ul>
<p>采用Informer库编写的Controller的架构如下图所示：<br>
<img src="https://blog-1255547500.cos.ap-beijing.myqcloud.com/images%2Fcncf%2Fk8s%2Fcustom%2F6.png" alt=""></p>
<p>图中间的虚线将图分为上下两部分，其中上半部分是 Informer 库中的组件，下半部分则是使用 Informer 库编写的自定义 Controller 中的组件，这两部分一起组成了一个完整的 Controller。</p>
<p>采用 Informer 机制编写的 Controller 中的主要流程如下：</p>
<ol>
<li>
<p>Reflector采用K8s HTTP API List/Watch API Server中指定的资源。<br>
Reflector会先List资源，然后使用 List 接口返回的resourceVersion来watch后续的资源变化。对应的源码<code>Reflector ListAndWatch</code>。</p>
</li>
<li>
<p>Reflector将List得到的资源列表和后续的资源变化放到一个FIFO（先进先出）队列中。对应的源码：</p>
<ul>
<li>使用 List 的结果刷新 FIFO 队列</li>
<li>将 Watch 收到的事件加入到 FIFO 队列</li>
</ul>
</li>
<li>
<p>Informer在一个循环中从FIFO队列中拿出资源对象进行处理。对应源码<code>processLoop</code>。</p>
</li>
<li>
<p>Informer将从FIFO队列中拿出的资源对象放到Indexer中。对应的源码<code>processDeltas</code>。<br>
Indexer是Informer中的一个本地缓存，该缓存提供了索引功能（这是该组件取名为 Indexer 的原因），允许基于特定条件（如标签、注释或字段选择器）快速有效地查找资源。此处代码中的<code>clientState</code> 就是Indexer，来自于<code>NewIndexerInformer</code>方法中构建的Indexer，该Indexer作为<code>clientState</code>参数传递给了<code>newInformer</code>方法。</p>
</li>
<li>
<p>Indexer将收到的资源对象放入其内部的缓存<code>ThreadSafeStore</code>中。</p>
</li>
<li>
<p>回调Controller的<code>ResourceEventHandler</code>，将资源对象变化通知到应用逻辑。对应的源码<code>processDeltas</code>。</p>
</li>
<li>
<p>在<code>ResourceEventHandler</code>对资源对象的变化进行处理<br>
<code>ResourceEventHandler</code>处于用户的Controller代码中，K8S推荐的编程范式是将收到的消息放入到一个队列中，然后在一个循环中处理该队列中的消息，执行调谐逻辑。推荐该模式的原因是采用队列可以解耦消息生产者（Informer）和消费者（Controller调谐逻辑），避免消费者阻塞生产者。在用户代码中需要注意几点：</p>
<ul>
<li>前面我们已经讲到，Reflector会使用List的结果刷新FIFO队列，因此<code>ResourceEventHandler</code>收到的资源变化消息其实包含了Informer启动时获取的完整资源列表，Informer会采用ADDED事件将列表的资源通知到用户Controller。该机制屏蔽了List和Watch的细节，保证用户的<code>ResourceEventHandler</code>代码中会接收到Controller监控的资源的完整数据，包括启动Controller前已有的资源数据，以及之后的资源变化。</li>
<li><code>ResourceEventHandler</code>中收到的消息中只有资源对象的key，用户在Controller中可以使用该key为关键字，通过Indexer查询本地缓存中的完整资源对象。</li>
</ul>
</li>
</ol>
<h2 id="实现一个Informer">实现一个Informer</h2>
<pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"flag"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"os"</span>
	<span class="token string">"resourceInformer/types"</span>

	<span class="token punctuation">.</span> <span class="token string">"resourceInformer/utils"</span>
	<span class="token string">"time"</span>

	<span class="token string">"github.com/spf13/viper"</span>

	corev1 <span class="token string">"k8s.io/api/core/v1"</span>
	metav1 <span class="token string">"k8s.io/apimachinery/pkg/apis/meta/v1"</span>
	<span class="token string">"k8s.io/apimachinery/pkg/util/runtime"</span>
	<span class="token string">"k8s.io/apimachinery/pkg/util/wait"</span>
	<span class="token string">"k8s.io/client-go/kubernetes"</span>
	<span class="token string">"k8s.io/client-go/rest"</span>
	<span class="token string">"k8s.io/client-go/tools/cache"</span>
	<span class="token string">"k8s.io/client-go/tools/clientcmd"</span>
	<span class="token string">"k8s.io/client-go/util/flowcontrol"</span>
	<span class="token string">"k8s.io/client-go/util/workqueue"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> conf <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"./conf/app.yaml"</span><span class="token punctuation">,</span> <span class="token string">"config file"</span><span class="token punctuation">)</span>

<span class="token comment">// Controller demonstrates how to implement a controller with client-go</span>
<span class="token keyword">type</span> Controller <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	indexer  cache<span class="token punctuation">.</span>Indexer
	queue    workqueue<span class="token punctuation">.</span>RateLimitingInterface
	informer cache<span class="token punctuation">.</span>Controller
	newObj   <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// NewController creates a new Controller</span>
<span class="token keyword">func</span> <span class="token function">NewController</span><span class="token punctuation">(</span>queue workqueue<span class="token punctuation">.</span>RateLimitingInterface<span class="token punctuation">,</span> indexer cache<span class="token punctuation">.</span>Indexer<span class="token punctuation">,</span> informer cache<span class="token punctuation">.</span>Controller<span class="token punctuation">)</span> <span class="token operator">*</span>Controller <span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Controller<span class="token punctuation">&#123;</span>
		informer<span class="token punctuation">:</span> informer<span class="token punctuation">,</span>
		indexer<span class="token punctuation">:</span>  indexer<span class="token punctuation">,</span>
		queue<span class="token punctuation">:</span>    queue<span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Controller<span class="token punctuation">)</span> <span class="token function">processNextItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// Wait until there is a new item in the working queue</span>
	queuekey<span class="token punctuation">,</span> quit <span class="token operator">:=</span> c<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> quit <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">// Tell the queue that we are done with processing this key</span>
	<span class="token keyword">defer</span> c<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span>queuekey<span class="token punctuation">)</span>
	<span class="token comment">// Invoke the method containing the business logic</span>
	err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">syncToStdout</span><span class="token punctuation">(</span>queuekey<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>QueueKey<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// Handle the error if something went wrong during the execution of the business logic</span>
	c<span class="token punctuation">.</span><span class="token function">handleErr</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> queuekey<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// syncToStdout is the business logic of the controller. In this controller it simply prints</span>
<span class="token comment">// information about the pod to stdout. In case an error happened, it has to simply return the error.</span>
<span class="token comment">// The retry logic should not be part of the business logic</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Controller<span class="token punctuation">)</span> <span class="token function">syncToStdout</span><span class="token punctuation">(</span>queuekey <span class="token operator">*</span>types<span class="token punctuation">.</span>QueueKey<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
	obj<span class="token punctuation">,</span> exists<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span>indexer<span class="token punctuation">.</span><span class="token function">GetByKey</span><span class="token punctuation">(</span>queuekey<span class="token punctuation">.</span>Key<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		Log<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"Fetching object[%s] from store failed: %v"</span><span class="token punctuation">,</span> queuekey<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>exists <span class="token punctuation">&#123;</span>
		<span class="token comment">// Below we will warm up our cache with a Pod, so that we will see a delete for one pod</span>
		Log<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">"Object[%s] does not exists, maybe it has been deleted"</span><span class="token punctuation">,</span> queuekey<span class="token punctuation">.</span>Key<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		phase <span class="token operator">:=</span> obj<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>corev1<span class="token punctuation">.</span>Pod<span class="token punctuation">)</span><span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Phase
		<span class="token keyword">if</span> queuekey<span class="token punctuation">.</span>Type <span class="token operator">==</span> types<span class="token punctuation">.</span>EVENT_ADDED <span class="token operator">&amp;&amp;</span> phase <span class="token operator">==</span> corev1<span class="token punctuation">.</span>PodPending <span class="token punctuation">&#123;</span>
			c<span class="token punctuation">.</span>newObj <span class="token operator">=</span> queuekey<span class="token punctuation">.</span>Key
		<span class="token punctuation">&#125;</span>
		<span class="token comment">// Note that you also have to check the uid if you have a local controlled resource, which</span>
		<span class="token comment">// is dependent on the actual instance, to detect that a Pod was recreated with the same name</span>
		Log<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">"Pod[%s] is %s, status = %s"</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>corev1<span class="token punctuation">.</span>Pod<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> queuekey<span class="token punctuation">.</span>Type<span class="token punctuation">,</span> phase<span class="token punctuation">)</span>
		<span class="token keyword">if</span> queuekey<span class="token punctuation">.</span>Type <span class="token operator">==</span> types<span class="token punctuation">.</span>EVENT_MODIFIED <span class="token operator">&amp;&amp;</span> phase <span class="token operator">==</span> corev1<span class="token punctuation">.</span>PodRunning <span class="token operator">&amp;&amp;</span> queuekey<span class="token punctuation">.</span>Key <span class="token operator">==</span> c<span class="token punctuation">.</span>newObj <span class="token punctuation">&#123;</span>
			Log<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">"A new pod is created, need to restart tools"</span><span class="token punctuation">)</span>
			<span class="token comment">// 重启tools deployment写在这里</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Controller<span class="token punctuation">)</span> <span class="token function">handleErr</span><span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">,</span> key <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token comment">// Forget about the #AddRateLimited history of the key on every successful synchronization.</span>
		<span class="token comment">// This ensures that future processing of updates for this key is not delayed because of</span>
		<span class="token comment">// an outdated error history.</span>
		c<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">Forget</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">// This controller retries 5 times if something goes wrong. After that, it stops trying</span>
	<span class="token keyword">if</span> c<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">NumRequeues</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">5</span> <span class="token punctuation">&#123;</span>
		Log<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">"Error synching pod[%v]: %v"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token comment">// Re-enqueue the key rate limited. Based on the rate limiter on the</span>
		<span class="token comment">// queue and the re-enqueue history, the key will be processed later again</span>
		c<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">AddRateLimited</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>

	c<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">Forget</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
	<span class="token comment">// Report to an external entity that, even after several retries, we could not successfully process this key</span>
	runtime<span class="token punctuation">.</span><span class="token function">HandleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	Log<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">"Dropping pod[%q] out of the queue: %v"</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Controller<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span>workers <span class="token builtin">int</span><span class="token punctuation">,</span> stopch <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">defer</span> runtime<span class="token punctuation">.</span><span class="token function">HandleCrash</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// Let the workers stop when we are done</span>
	<span class="token keyword">defer</span> c<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">ShutDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	Log<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">"Starting Pod controller"</span><span class="token punctuation">)</span>

	<span class="token keyword">go</span> c<span class="token punctuation">.</span>informer<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>stopch<span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token operator">!</span>cache<span class="token punctuation">.</span><span class="token function">WaitForCacheSync</span><span class="token punctuation">(</span>stopch<span class="token punctuation">,</span> c<span class="token punctuation">.</span>informer<span class="token punctuation">.</span>HasSynced<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		runtime<span class="token punctuation">.</span><span class="token function">HandleError</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"Timed out waiting for caches to sync"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> workers<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">go</span> wait<span class="token punctuation">.</span><span class="token function">Until</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>runWorker<span class="token punctuation">,</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span> stopch<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

	<span class="token operator">&lt;-</span>stopch
	Log<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">"Stopping Pod controller"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Controller<span class="token punctuation">)</span> <span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">for</span> c<span class="token punctuation">.</span><span class="token function">processNextItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> environment <span class="token operator">=</span> <span class="token string">"local"</span>
<span class="token keyword">var</span> kubeconfig <span class="token operator">=</span> <span class="token string">"./kubeconfig"</span>

<span class="token keyword">func</span> <span class="token function">createKubernetes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>kubernetes<span class="token punctuation">.</span>Clientset <span class="token punctuation">&#123;</span>
	Log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">"Using namespace=default"</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> conf <span class="token operator">*</span>rest<span class="token punctuation">.</span>Config
	<span class="token keyword">var</span> err <span class="token builtin">error</span>
	<span class="token keyword">if</span> environment <span class="token operator">==</span> <span class="token string">"local"</span> <span class="token punctuation">&#123;</span>
		Log<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">"Using kubeconfig=%s"</span><span class="token punctuation">,</span> kubeconfig<span class="token punctuation">)</span>
		conf<span class="token punctuation">,</span> err <span class="token operator">=</span> clientcmd<span class="token punctuation">.</span><span class="token function">BuildConfigFromFlags</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> kubeconfig<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		Log<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">"Using serviceaccount=default"</span><span class="token punctuation">)</span>
		conf<span class="token punctuation">,</span> err <span class="token operator">=</span> rest<span class="token punctuation">.</span><span class="token function">InClusterConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		conf<span class="token punctuation">.</span>RateLimiter <span class="token operator">=</span> flowcontrol<span class="token punctuation">.</span><span class="token function">NewTokenBucketRateLimiter</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// setting a big ratelimiter for client-side throttling, default 5</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		Log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	clientset<span class="token punctuation">,</span> err <span class="token operator">:=</span> kubernetes<span class="token punctuation">.</span><span class="token function">NewForConfig</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		Log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> clientset
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	clientset <span class="token operator">:=</span> <span class="token function">createKubernetes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// create the pod watcher</span>
	optionsModifier <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>options <span class="token operator">*</span>metav1<span class="token punctuation">.</span>ListOptions<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		options<span class="token punctuation">.</span>LabelSelector <span class="token operator">=</span> <span class="token string">"app=nginx"</span>
	<span class="token punctuation">&#125;</span>
	podListWatcher <span class="token operator">:=</span> cache<span class="token punctuation">.</span><span class="token function">NewFilteredListWatchFromClient</span><span class="token punctuation">(</span>clientset<span class="token punctuation">.</span><span class="token function">CoreV1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">RESTClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"pods"</span><span class="token punctuation">,</span> <span class="token string">"default"</span><span class="token punctuation">,</span> optionsModifier<span class="token punctuation">)</span>

	<span class="token comment">// create the workqueue</span>
	queue <span class="token operator">:=</span> workqueue<span class="token punctuation">.</span><span class="token function">NewRateLimitingQueue</span><span class="token punctuation">(</span>workqueue<span class="token punctuation">.</span><span class="token function">DefaultControllerRateLimiter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">// Bind the workqueue to a cache with the help of an informer. This way we make sure that</span>
	<span class="token comment">// whenever the cache is updated, the pod key is added to the workqueue.</span>
	<span class="token comment">// Note that when we finally process the item from the workqueue, we might see a newer version</span>
	<span class="token comment">// of the Pod than the version which was responsible for triggering the update.</span>
	indexer<span class="token punctuation">,</span> informer <span class="token operator">:=</span> cache<span class="token punctuation">.</span><span class="token function">NewIndexerInformer</span><span class="token punctuation">(</span>podListWatcher<span class="token punctuation">,</span> <span class="token operator">&amp;</span>corev1<span class="token punctuation">.</span>Pod<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span>ResourceEventHandlerFuncs<span class="token punctuation">&#123;</span>
		AddFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>obj <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			key<span class="token punctuation">,</span> err <span class="token operator">:=</span> cache<span class="token punctuation">.</span><span class="token function">MetaNamespaceKeyFunc</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
				queue<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>types<span class="token punctuation">.</span>QueueKey<span class="token punctuation">&#123;</span>
					Type<span class="token punctuation">:</span> types<span class="token punctuation">.</span>EVENT_ADDED<span class="token punctuation">,</span>
					Key<span class="token punctuation">:</span>  key<span class="token punctuation">,</span>
				<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
		UpdateFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>old <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token builtin">new</span> <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			key<span class="token punctuation">,</span> err <span class="token operator">:=</span> cache<span class="token punctuation">.</span><span class="token function">MetaNamespaceKeyFunc</span><span class="token punctuation">(</span><span class="token builtin">new</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
				queue<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>types<span class="token punctuation">.</span>QueueKey<span class="token punctuation">&#123;</span>
					Type<span class="token punctuation">:</span> types<span class="token punctuation">.</span>EVENT_MODIFIED<span class="token punctuation">,</span>
					Key<span class="token punctuation">:</span>  key<span class="token punctuation">,</span>
				<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
		DeleteFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>obj <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token comment">// IndexerInformer uses a delta queue, therefore for deletes we have to use this</span>
			<span class="token comment">// key function.</span>
			key<span class="token punctuation">,</span> err <span class="token operator">:=</span> cache<span class="token punctuation">.</span><span class="token function">DeletionHandlingMetaNamespaceKeyFunc</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
				queue<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>types<span class="token punctuation">.</span>QueueKey<span class="token punctuation">&#123;</span>
					Type<span class="token punctuation">:</span> types<span class="token punctuation">.</span>EVENT_DELETED<span class="token punctuation">,</span>
					Key<span class="token punctuation">:</span>  key<span class="token punctuation">,</span>
				<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
				Log<span class="token punctuation">.</span><span class="token function">Infof</span><span class="token punctuation">(</span><span class="token string">"Pod[%s] is DELETED"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> cache<span class="token punctuation">.</span>Indexers<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

	controller <span class="token operator">:=</span> <span class="token function">NewController</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> indexer<span class="token punctuation">,</span> informer<span class="token punctuation">)</span>

	<span class="token comment">// Now let's start the controller</span>
	stop <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>stop<span class="token punctuation">)</span>
	<span class="token keyword">go</span> controller<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> stop<span class="token punctuation">)</span>

	<span class="token comment">// Wait forever</span>
	<span class="token keyword">select</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	flag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">*</span>conf <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>
		Log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">"No config file specified"</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	viper<span class="token punctuation">.</span><span class="token function">SetConfigFile</span><span class="token punctuation">(</span><span class="token operator">*</span>conf<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadInConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		Log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"Reading config file failed: %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	viper<span class="token punctuation">.</span><span class="token function">WatchConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token function">InitLogger</span><span class="token punctuation">(</span>viper<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"Log.Level"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"Kubeconfig"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>
		kubeconfig <span class="token operator">=</span> viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">"Kubeconfig"</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>编译运行此程序，指定好kubeconfig文件，使其连接到一个K8S上：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">student@k8s-master:~$ ./informer <span class="token parameter variable">-c</span> app.yaml
<span class="token number">2023</span>/12/22 <span class="token number">11</span>:42:24.446 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Using <span class="token assign-left variable">namespace</span><span class="token operator">=</span>default
<span class="token number">2023</span>/12/22 <span class="token number">11</span>:42:24.446 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Using <span class="token assign-left variable">kubeconfig</span><span class="token operator">=</span>/home/student/.kube/config
<span class="token number">2023</span>/12/22 <span class="token number">11</span>:42:24.449 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Starting Pod controller<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>本程序监听了default命名空间下，label为app=nginx的POD的状态，其状态判断条件为：<br>
<code>if queuekey.Type == types.EVENT_MODIFIED &amp;&amp; phase == corev1.PodRunning &amp;&amp; queuekey.Key == c.newObj</code><br>
即一个POD事件是<code>MODIFIED</code>，且其状态为<code>PodRunning</code>，且POD名是一个新的名称（即这个POD是一个新建的POD，对应的场景是其所属的deployment被重启了）。</p>
<p>现在向default空间提交一个nginx的deployment，查看informer监听的事件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">2023</span>/12/22 <span class="token number">11</span>:45:13.456 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Pod<span class="token punctuation">[</span>nginx-5776d4fd9d-pplcs<span class="token punctuation">]</span> is ADDED, status <span class="token operator">=</span> Pending
<span class="token number">2023</span>/12/22 <span class="token number">11</span>:45:13.474 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Pod<span class="token punctuation">[</span>nginx-5776d4fd9d-pplcs<span class="token punctuation">]</span> is MODIFIED, status <span class="token operator">=</span> Pending
<span class="token number">2023</span>/12/22 <span class="token number">11</span>:45:13.518 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Pod<span class="token punctuation">[</span>nginx-5776d4fd9d-pplcs<span class="token punctuation">]</span> is MODIFIED, status <span class="token operator">=</span> Pending
<span class="token number">2023</span>/12/22 <span class="token number">11</span>:45:14.638 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Pod<span class="token punctuation">[</span>nginx-5776d4fd9d-pplcs<span class="token punctuation">]</span> is MODIFIED, status <span class="token operator">=</span> Pending
<span class="token number">2023</span>/12/22 <span class="token number">11</span>:45:15.538 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Pod<span class="token punctuation">[</span>nginx-5776d4fd9d-pplcs<span class="token punctuation">]</span> is MODIFIED, status <span class="token operator">=</span> Running
<span class="token number">2023</span>/12/22 <span class="token number">11</span>:45:15.541 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> A new pod is created, need to restart tools<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote><p>本文涉及到的两份完整代码参见：<a target="_blank" rel="noopener" href="https://gitee.com/hongyuxuan2138/resource-informer">https://gitee.com/hongyuxuan2138/resource-informer</a></p>
</blockquote>
<h2 id="后记">后记</h2>
<p>通过自定义一个Informer相当于自己实现了一个资源的Controller，通常可用于以下场景：需要监听一些事件，并根据这些事件做一些其它资源的变更。这种场景如果不使用Informer，还可以通过定时刷新K8S资源状态来实现，但显然从逼格上来看就不如Informer。</p>
<h3 id="Informer在我司的应用场景">Informer在我司的应用场景</h3>
<p>我们在公司的K8S集群内部署了一套RedisCluster，因为他是容器内部署，客户端要连接它的话也必须部署在相同的容器集群内。如果客户端在容器集群外，就无法连上。原因是Cluster方式的Redis节点间通信使用的是私有地址（即POD IP），当我set一个key到Redis时，它会根据一定的规则决定将key分配给固定的slot，这个slot可能不在我当前连接的Redis副本上，而在另一个副本上（POD）。当前连接会把slot所在副本的IP（即POD IP）返回给客户端，这个IP是POD私有地址，容器外的客户端根本无法连接。解决这个问题的办法是我们又装了一个RedisCluster代理<code>predixy</code>，但这个代理有个bug，当它连接的RedisCluster有一个副本挂了，它不会自动清除这个已经失效的连接。此时如果客户端的访问正好落到这个失效的副本，就会报错连不上，必须重启<code>predix</code>才能重新和RedisCluster的当副本建立新连接。</p>
<p>问题来了，我怎么知道RedisCluster有一个POD重启了呢？Informer正是干这个事情的。我们自定义开发了一个Informer监视RedisCluster的POD重启事件，一旦发生后就去重启<code>predixy</code>，算是临时解决了这个bug。</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/blog/about" rel="external nofollow noreferrer">洪宇轩</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://hongyuxuan2138.gitee.io/blog/blog/posts/65360882/">https://hongyuxuan2138.gitee.io/blog/blog/posts/65360882/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/blog/about" target="_blank">洪宇轩</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/blog/tags/cloud-native/">
                                    <span class="chip bg-color">cloud native</span>
                                </a>
                            
                                <a href="/blog/tags/kubernetes/">
                                    <span class="chip bg-color">kubernetes</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/blog/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/blog/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/blog/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/blog/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/blog/posts/65360882/">
                    <div class="card-image">
                        
                        <img src="https://blog-1255547500.cos.ap-beijing.myqcloud.com/images%2Fcncf%2Fk8s%2Fcustom%2Fcontroller_banner.jpg" class="responsive-img" alt="K8S二次开发系列之四：自定义开发Controller">
                        
                        <span class="card-title">K8S二次开发系列之四：自定义开发Controller</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本文介绍了Kubernetes Controller的工作原理、Kubernetes API List/Watch的机制，以及client-go提供的Informer库，教你通过以上技术自定义开发自己的Controller。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-12-15
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/blog/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/" class="post-category">
                                    云原生
                                </a>
                            
                            <a href="/blog/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/" class="post-category">
                                    kubernetes
                                </a>
                            
                            <a href="/blog/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/K8S%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97/" class="post-category">
                                    K8S二次开发系列
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/blog/tags/cloud-native/">
                        <span class="chip bg-color">cloud native</span>
                    </a>
                    
                    <a href="/blog/tags/kubernetes/">
                        <span class="chip bg-color">kubernetes</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/blog/posts/1902483454/">
                    <div class="card-image">
                        
                        <img src="https://blog-1255547500.cos.ap-beijing.myqcloud.com/images%2Fcncf%2Fk8s%2Fcustom%2Fadmission_banner.jpeg" class="responsive-img" alt="K8S二次开发系列之三：自定义开发Admission Webhook">
                        
                        <span class="card-title">K8S二次开发系列之三：自定义开发Admission Webhook</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本文教你如何自定义开发自己的admission webook，包括验证型准入控制器（validating admission webhook）和变更型准入控制器（mutating admission webhook）。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-12-07
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/blog/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/" class="post-category">
                                    云原生
                                </a>
                            
                            <a href="/blog/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/" class="post-category">
                                    kubernetes
                                </a>
                            
                            <a href="/blog/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/kubernetes/K8S%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97/" class="post-category">
                                    K8S二次开发系列
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/blog/tags/cloud-native/">
                        <span class="chip bg-color">cloud native</span>
                    </a>
                    
                    <a href="/blog/tags/kubernetes/">
                        <span class="chip bg-color">kubernetes</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/blog/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/blog/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/blog/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/blog/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/blog/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/blog/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/blog/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/blog/libs/aplayer/APlayer.min.js"></script>
<script src="/blog/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2023</span>
            
            <a href="/blog/about" target="_blank">洪宇轩</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">44.4k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://gitee.com/hongyuxuan2138" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:hongyx2014@126.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=392951721" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 392951721" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/blog/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/blog/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/blog/libs/materialize/materialize.min.js"></script>
    <script src="/blog/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/blog/libs/aos/aos.js"></script>
    <script src="/blog/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/blog/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/blog/js/matery.js"></script>

    
        <!-- <script src='https://unpkg.com/mermaid@latest/dist/mermaid.min.js'></script> -->
        <script src='/blog/libs/mermaid/mermaid.min.js'></script>
        <script>
          if (window.mermaid) {
            mermaid.initialize({theme: 'forest'});
          }
        </script>
    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/blog/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/blog/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/blog/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/blog/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
